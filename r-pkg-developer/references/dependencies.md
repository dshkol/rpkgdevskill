# Package Dependencies

## Imports vs Suggests vs Depends

| Field | When to Use | Installation | In Code |
|-------|-------------|--------------|---------|
| **Imports** | Required for core functionality | Auto-installed | Always available |
| **Suggests** | Tests, vignettes, optional features | Not auto-installed | Check availability |
| **Depends** | Minimum R version only | Auto-attached | Avoid for packages |

## Adding Dependencies

```r
# Add to Imports (default)
usethis::use_package("dplyr")

# Add to Suggests
usethis::use_package("testthat", type = "Suggests")

# Add minimum version
usethis::use_package("rlang", min_version = "1.0.0")

# Development dependency (Suggests + Remotes)
usethis::use_dev_package("pkgload")
```

## Using Imported Packages

### Preferred: Explicit namespacing
```r
my_function <- function(data) {
  dplyr::filter(data, x > 0) |>
    dplyr::mutate(y = x * 2)
}
```

### Alternative: Import specific functions
In roxygen comments:
```r
#' @importFrom dplyr filter mutate
```

Or in `R/package-package.R`:
```r
#' @importFrom rlang .data `:=`
```

### Never: Import entire package
Avoid `@import package` - pollutes namespace.

## Using Suggested Packages

Always check availability:
```r
my_function <- function(data) {
  if (!requireNamespace("ggplot2", quietly = TRUE)) {
    stop("Package 'ggplot2' required. Install with: install.packages('ggplot2')")
  }
  ggplot2::ggplot(data, ggplot2::aes(x, y)) +
    ggplot2::geom_point()
}
```

With rlang helper:
```r
my_function <- function(data) {
  rlang::check_installed("ggplot2", reason = "to create plots")
  # ggplot2 is now available
}
```

## NAMESPACE File

Generated by roxygen2. Contains:
```
# Exports (what users can access)
export(my_function)
export(another_function)

# Imports (what your package uses)
importFrom(dplyr,filter)
importFrom(rlang,.data)

# S3 methods
S3method(print,myclass)
```

Regenerate with:
```r
devtools::document()
```

## Version Requirements

### When to specify
- Using features introduced in specific version
- Known bugs in older versions
- Breaking changes in newer versions

### How to specify
```
Imports:
    dplyr (>= 1.0.0),
    rlang (>= 0.4.0)
```

### Be conservative
Don't over-specify. Users appreciate flexibility.

## Dependency Analysis

```r
# View dependency tree
pak::pkg_deps_tree("mypackage")

# Count dependencies
length(tools::package_dependencies("mypackage", recursive = TRUE)[[1]])
```

## Low-Cost Dependencies

These "tidyverse core" packages are effectively free:
- `rlang` - tidy evaluation, errors
- `cli` - user interface
- `glue` - string interpolation
- `withr` - state management
- `lifecycle` - function lifecycle
- `vctrs` - vector operations

## High-Cost Dependencies

Avoid depending on:
- `tidyverse` (meta-package with 100+ deps)
- `devtools` (development tool)
- Packages with system requirements (ImageMagick, Java)
- Packages with many recursive dependencies

## Conditional Features

For optional functionality:
```r
#' Plot results
#'
#' @param data Input data.
#' @returns A ggplot object if ggplot2 is installed, otherwise NULL.
plot_results <- function(data) {
  if (!requireNamespace("ggplot2", quietly = TRUE)) {
    message("Install ggplot2 for plotting: install.packages('ggplot2')")
    return(invisible(NULL))
  }

  ggplot2::ggplot(data, ggplot2::aes(x, y)) +
    ggplot2::geom_point()
}
```

## CRAN Limits

CRAN warns if you import 20+ non-default packages. Strategies:
- Move rarely-used dependencies to Suggests
- Check availability at runtime for optional features
- Consider if dependency is worth the cost

## System Dependencies

Document in DESCRIPTION:
```
SystemRequirements: libcurl, OpenSSL
```

Note: This is informational only. R doesn't auto-install system deps.
